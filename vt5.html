<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Saint-Valentin</title>
  <style>
    :root{
      --bg1:#ffd6dc;
      --bg2:#f2a7b5;
      --card:#ffffffcc;
      --text:#151515;
      --muted:#3a3a3a;
      --accent:#ff2f62;
      --accent2:#ff7aa0;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      min-height:100vh;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:
        radial-gradient(1200px 600px at 20% 10%, var(--bg1), transparent 60%),
        radial-gradient(1200px 700px at 80% 90%, var(--bg2), transparent 55%),
        linear-gradient(135deg, #ffe6ea 0%, #f0a7b5 100%);
      color:var(--text);
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px;
      overflow:hidden;
    }

    /* particules soft */
    .noise{
      position:fixed; inset:-20%;
      background-image:
        radial-gradient(circle at 10% 20%, rgba(255,255,255,.55) 0 2px, transparent 3px),
        radial-gradient(circle at 70% 30%, rgba(255,255,255,.45) 0 2px, transparent 3px),
        radial-gradient(circle at 30% 80%, rgba(255,255,255,.45) 0 2px, transparent 3px),
        radial-gradient(circle at 90% 70%, rgba(255,255,255,.35) 0 2px, transparent 3px);
      filter: blur(.2px);
      opacity:.35;
      pointer-events:none;
      animation: drift 7s ease-in-out infinite alternate;
      transform: translate3d(0,0,0);
    }
    @keyframes drift{
      from{transform:translate3d(0,0,0)}
      to{transform:translate3d(0,-14px,0)}
    }

    /* conteneur 3D */
    .stage{
      perspective: 1200px;
      width: min(820px, 100%);
      position:relative;
    }

    .card{
      width:100%;
      background:var(--card);
      border:1px solid rgba(255,255,255,.55);
      border-radius:24px;
      box-shadow: 0 30px 80px rgba(0,0,0,.18);
      padding:28px;
      backdrop-filter: blur(10px);
      transform-style: preserve-3d;
      will-change: transform;
      position:relative;
      overflow:hidden;
    }

    /* halo */
    .card::before{
      content:"";
      position:absolute; inset:-40%;
      background: radial-gradient(circle at var(--mx, 50%) var(--my, 50%),
        rgba(255,255,255,.55), transparent 55%);
      opacity:.55;
      transform: translateZ(-10px);
      pointer-events:none;
    }

    .title{
      font-size: clamp(26px, 3.4vw, 44px);
      margin:0 0 8px;
      letter-spacing:-.8px;
      transform: translateZ(30px);
    }
    .subtitle{
      margin:0 0 18px;
      font-size: clamp(14px, 2vw, 18px);
      opacity:.86;
      line-height:1.45;
      transform: translateZ(22px);
      color: var(--muted);
    }

    .row{
      display:flex;
      gap:12px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
      transform: translateZ(18px);
    }
    .pill{
      background:rgba(255,255,255,.75);
      border:1px solid rgba(0,0,0,.06);
      padding:8px 12px;
      border-radius:999px;
      font-size:13px;
      opacity:.9;
    }

    .progress{
      height:10px;
      background:rgba(255,255,255,.65);
      border-radius:999px;
      overflow:hidden;
      margin: 12px 0 22px;
      transform: translateZ(14px);
    }
    .bar{
      height:100%;
      width:0%;
      background: linear-gradient(90deg, var(--accent), var(--accent2));
      border-radius:999px;
      transition: width .35s ease;
    }

    .q{
      font-size: clamp(18px, 2.4vw, 26px);
      margin: 10px 0 18px;
      line-height:1.25;
      transform: translateZ(24px);
    }

    .choices{
      display:grid;
      gap:12px;
      grid-template-columns: 1fr;
      margin-bottom: 10px;
      transform: translateZ(20px);
    }

    button{
      border:0;
      border-radius:16px;
      padding:14px 16px;
      font-size:16px;
      cursor:pointer;
      transition: transform .08s ease, filter .2s ease, box-shadow .2s ease;
      font-weight:650;
    }
    button:active{transform: scale(.985)}
    .btn{
      background:#fff;
      border:1px solid rgba(0,0,0,.07);
      text-align:left;
      box-shadow: 0 10px 20px rgba(0,0,0,.06);
    }
    .btn:hover{filter:brightness(.985); box-shadow: 0 14px 28px rgba(0,0,0,.08);}

    .primary{
      background: linear-gradient(90deg, var(--accent), var(--accent2));
      color:white;
      text-align:center;
      box-shadow: 0 14px 34px rgba(255,47,98,.25);
      font-weight:800;
    }

    .note{
      font-size:13px;
      opacity:.72;
      margin-top:8px;
      line-height:1.35;
      transform: translateZ(14px);
      color: var(--muted);
    }

    /* Peluche coeur */
    .plushWrap{
      position:absolute;
      right:-14px;
      top:-18px;
      width:170px;
      height:170px;
      transform-style: preserve-3d;
      pointer-events:none;
      filter: drop-shadow(0 28px 35px rgba(0,0,0,.16));
    }
    .plush{
      position:absolute; inset:0;
      border-radius: 42% 58% 55% 45% / 50% 45% 55% 50%;
      background:
        radial-gradient(circle at 30% 25%, rgba(255,255,255,.85), transparent 45%),
        radial-gradient(circle at 70% 65%, rgba(0,0,0,.10), transparent 55%),
        linear-gradient(135deg, #ff2f62 0%, #ff7aa0 100%);
      transform: translateZ(40px);
      animation: floaty 4.8s ease-in-out infinite;
    }
    .plush::before, .plush::after{
      content:"";
      position:absolute;
      width:66px; height:66px;
      border-radius:999px;
      background:
        radial-gradient(circle at 30% 25%, rgba(255,255,255,.8), transparent 50%),
        linear-gradient(135deg, #ff3a6b 0%, #ff95b2 100%);
      opacity:.95;
      transform: translateZ(30px);
    }
    .plush::before{ left:-18px; top:58px; }
    .plush::after{ right:-18px; top:58px; }

    .snout{
      position:absolute;
      left:50%; top:72px;
      width:64px; height:46px;
      border-radius: 999px;
      transform: translate(-50%,0) translateZ(55px);
      background: rgba(255,255,255,.70);
      box-shadow: inset 0 -8px 14px rgba(0,0,0,.06);
      opacity:.95;
    }
    .eye{
      position:absolute;
      top:86px;
      width:9px; height:9px;
      border-radius:999px;
      background: rgba(0,0,0,.5);
      transform: translateZ(60px);
    }
    .eye.left{ left:70px; }
    .eye.right{ left:92px; }
    .smile{
      position:absolute;
      left:50%; top:97px;
      width:26px; height:14px;
      border:2px solid rgba(0,0,0,.35);
      border-top:0;
      border-left:0;
      border-right:0;
      border-radius: 0 0 999px 999px;
      transform: translate(-50%,0) translateZ(60px);
      opacity:.8;
    }
    @keyframes floaty{
      0%,100%{ transform: translate3d(0,0,40px) rotateZ(-2deg); }
      50%{ transform: translate3d(0,10px,40px) rotateZ(2deg); }
    }

    /* √©cran enigme */
    .riddle{
      padding: 8px 0 0;
      display:flex;
      flex-direction:column;
      gap:12px;
      align-items:flex-start;
    }
    .riddleBox{
      width:100%;
      background: rgba(255,255,255,.78);
      border: 1px solid rgba(0,0,0,.06);
      border-radius: 18px;
      padding: 16px;
      box-shadow: 0 14px 30px rgba(0,0,0,.07);
    }
    .riddleTitle{
      margin:0 0 6px;
      font-size: 16px;
      font-weight: 900;
      letter-spacing:-.3px;
    }
    .riddleText{
      margin:0;
      opacity:.85;
      line-height:1.4;
      color: var(--muted);
    }
    .riddleHint{
      margin:10px 0 0;
      font-size: 13px;
      opacity:.75;
    }

    /* ===== √âCRAN DEMANDE + GROSSE SC√àNE 3D ===== */
    .askWrap{
      padding: 18px 6px 6px;
      display:flex;
      flex-direction:column;
      gap:18px;
      align-items:center;
      justify-content:center;
      position:relative;
      transform-style: preserve-3d;
      min-height: 560px;
    }
    .askTitle{
      font-size: clamp(40px, 5.8vw, 78px);
      letter-spacing: -1.6px;
      line-height: 0.98;
      text-align:center;
      margin: 0;
      transform: translateZ(40px);
    }
    .askButtons{
      display:flex;
      gap:14px;
      flex-wrap:wrap;
      justify-content:center;
      width:100%;
      transform: translateZ(22px);
      position:relative;
      z-index:3;
    }
    .yesBtn{
      min-width: 220px;
      background: linear-gradient(90deg, var(--accent), var(--accent2));
      color:white;
      font-weight:950;
      box-shadow: 0 18px 42px rgba(255,47,98,.28);
    }
    .noBtn{
      min-width: 220px;
      background:#fff;
      border:1px solid rgba(0,0,0,.08);
      font-weight:950;
      box-shadow: 0 12px 26px rgba(0,0,0,.08);
    }

    .scene3d{
      width: min(720px, 100%);
      height: 360px;
      position: relative;
      perspective: 1200px;
      transform-style: preserve-3d;
      margin-top: 4px;
      z-index:1;
    }
    .rig{
      position:absolute; inset:0;
      transform-style: preserve-3d;
      animation: rigSpin 7.5s ease-in-out infinite alternate;
    }
    @keyframes rigSpin{
      from{ transform: rotateX(10deg) rotateY(-14deg) translateZ(0); }
      to{ transform: rotateX(-10deg) rotateY(16deg) translateZ(0); }
    }

    /* coeurs/texte */
    .banner{
      position:absolute;
      left:50%;
      top:10px;
      transform: translateX(-50%) translateZ(65px);
      font-weight: 950;
      font-size: clamp(18px, 2.4vw, 28px);
      letter-spacing: -0.6px;
      text-transform: uppercase;
      background: linear-gradient(90deg, #ff2f62, #ff7aa0);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      filter: drop-shadow(0 12px 20px rgba(0,0,0,.12));
      opacity:.95;
      z-index:2;
      pointer-events:none;
    }

    /* HEART 3D */
    .heart3d{
      position:absolute;
      left:50%;
      top:56%;
      width: 190px;
      height: 190px;
      transform: translate(-50%,-50%) translateZ(80px) rotateZ(45deg);
      transform-style: preserve-3d;
      animation: heartPulse 1.5s ease-in-out infinite;
      filter: drop-shadow(0 32px 48px rgba(0,0,0,.18));
    }
    @keyframes heartPulse{
      0%,100%{ transform: translate(-50%,-50%) translateZ(80px) rotateZ(45deg) scale(1); }
      50%{ transform: translate(-50%,-50%) translateZ(95px) rotateZ(45deg) scale(1.07); }
    }
    .heart3d .core{
      position:absolute; inset:0;
      background: linear-gradient(135deg, #ff2f62, #ff7aa0);
      border-radius: 22px;
      box-shadow: inset 0 -18px 34px rgba(0,0,0,.12);
      transform: translateZ(16px);
    }
    .heart3d .core::before,
    .heart3d .core::after{
      content:"";
      position:absolute;
      width: 190px;
      height: 190px;
      border-radius: 999px;
      background: inherit;
    }
    .heart3d .core::before{ left:-95px; top:0; }
    .heart3d .core::after{ left:0; top:-95px; }
    .heart3d .depth{
      position:absolute; inset:0;
      border-radius: 22px;
      background: linear-gradient(135deg, rgba(0,0,0,.08), rgba(0,0,0,.18));
      transform: translateZ(0px);
      opacity:.42;
    }

    /* FLOWER 3D */
    .flower3d{
      position:absolute;
      left: 18%;
      top: 60%;
      transform: translate(-50%,-50%) translateZ(55px);
      transform-style: preserve-3d;
      animation: floatA 3.5s ease-in-out infinite;
      filter: drop-shadow(0 24px 34px rgba(0,0,0,.16));
    }
    @keyframes floatA{
      0%,100%{ transform: translate(-50%,-50%) translateZ(55px) rotateZ(-6deg); }
      50%{ transform: translate(-50%,-57%) translateZ(72px) rotateZ(6deg); }
    }
    .flower3d .stem{
      position:absolute;
      left:50%; top:62px;
      width: 12px; height: 190px;
      transform: translateX(-50%) translateZ(10px);
      border-radius: 999px;
      background: linear-gradient(180deg, #2fd07b, #0c8f4a);
      box-shadow: inset 0 -10px 16px rgba(0,0,0,.18);
    }
    .flower3d .leaf{
      position:absolute;
      left:50%; top:146px;
      width: 92px; height: 48px;
      border-radius: 999px 999px 999px 10px;
      background: linear-gradient(135deg, #2fd07b, #0c8f4a);
      transform-origin: left center;
      box-shadow: inset 0 -10px 16px rgba(0,0,0,.16);
    }
    .flower3d .leaf.l1{ transform: translateX(-10px) rotateZ(-22deg) translateZ(12px); }
    .flower3d .leaf.l2{ transform: translateX(-82px) rotateY(180deg) rotateZ(-12deg) translateZ(8px); opacity:.95; }
    .flower3d .head{
      position:absolute;
      left:50%; top:0;
      width: 150px; height: 150px;
      transform: translateX(-50%) translateZ(30px);
      transform-style: preserve-3d;
    }
    .flower3d .petal{
      position:absolute;
      left:50%; top:50%;
      width: 70px; height: 105px;
      border-radius: 999px;
      transform-origin: center 82%;
      background: linear-gradient(135deg, #fff, #ffd1db);
      box-shadow: inset 0 -14px 20px rgba(0,0,0,.12);
      filter: saturate(1.05);
    }
    .flower3d .petal:nth-child(1){ transform: translate(-50%,-50%) rotateZ(0deg)   translateY(-30px) translateZ(0px); }
    .flower3d .petal:nth-child(2){ transform: translate(-50%,-50%) rotateZ(45deg)  translateY(-30px) translateZ(2px); }
    .flower3d .petal:nth-child(3){ transform: translate(-50%,-50%) rotateZ(90deg)  translateY(-30px) translateZ(0px); }
    .flower3d .petal:nth-child(4){ transform: translate(-50%,-50%) rotateZ(135deg) translateY(-30px) translateZ(2px); }
    .flower3d .petal:nth-child(5){ transform: translate(-50%,-50%) rotateZ(180deg) translateY(-30px) translateZ(0px); }
    .flower3d .petal:nth-child(6){ transform: translate(-50%,-50%) rotateZ(225deg) translateY(-30px) translateZ(2px); }
    .flower3d .petal:nth-child(7){ transform: translate(-50%,-50%) rotateZ(270deg) translateY(-30px) translateZ(0px); }
    .flower3d .petal:nth-child(8){ transform: translate(-50%,-50%) rotateZ(315deg) translateY(-30px) translateZ(2px); }
    .flower3d .center{
      position:absolute;
      left:50%; top:50%;
      width: 62px; height: 62px;
      border-radius: 999px;
      transform: translate(-50%,-50%) translateZ(14px);
      background: radial-gradient(circle at 30% 30%, #fff6a6, #ffcc3a);
      box-shadow: inset 0 -12px 18px rgba(0,0,0,.16);
    }

    /* CHOCOLATE 3D */
    .choco3d{
      position:absolute;
      left: 84%;
      top: 62%;
      width: 200px;
      height: 140px;
      transform: translate(-50%,-50%) translateZ(45px) rotateZ(10deg);
      transform-style: preserve-3d;
      animation: floatB 3.8s ease-in-out infinite;
      filter: drop-shadow(0 24px 34px rgba(0,0,0,.16));
    }
    @keyframes floatB{
      0%,100%{ transform: translate(-50%,-50%) translateZ(45px) rotateZ(10deg); }
      50%{ transform: translate(-50%,-58%) translateZ(68px) rotateZ(-8deg); }
    }
    .choco3d .bar{
      position:absolute; inset:0;
      border-radius: 20px;
      background: linear-gradient(135deg, #4a2418, #8b4a2d);
      box-shadow: inset 0 -20px 30px rgba(0,0,0,.22);
      transform: translateZ(12px);
    }
    .choco3d .grid{
      position:absolute; inset:14px;
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:10px;
      transform: translateZ(20px);
    }
    .choco3d .sq{
      border-radius: 14px;
      background: linear-gradient(135deg, #5a2d1e, #a05a3b);
      box-shadow: inset 0 -10px 16px rgba(0,0,0,.22);
    }
    .choco3d .wrap{
      position:absolute;
      left:-18px; top:10px;
      width: 60px; height: 120px;
      border-radius: 16px;
      background: linear-gradient(135deg, rgba(255,255,255,.7), rgba(255,255,255,.2));
      transform: translateZ(6px) rotateZ(-8deg);
      opacity:.55;
    }

    /* confettis */
    .spark{
      position:absolute;
      width:10px; height:10px;
      border-radius:999px;
      background: rgba(255,255,255,.88);
      filter: blur(.2px);
      opacity:.85;
      animation: spark 2.6s ease-in-out infinite;
      pointer-events:none;
    }
    @keyframes spark{
      0%,100%{ transform: translate3d(0,0,0) scale(1); opacity:.55; }
      50%{ transform: translate3d(0,-22px,0) scale(1.28); opacity:1; }
    }

    /* toast */
    .toast{
      position:fixed;
      left:50%;
      bottom:20px;
      transform:translateX(-50%);
      background:#111;
      color:#fff;
      padding:12px 14px;
      border-radius:999px;
      font-size:14px;
      opacity:0;
      pointer-events:none;
      transition: opacity .25s ease, transform .25s ease;
      z-index:20;
    }
    .toast.show{
      opacity:1;
      transform:translateX(-50%) translateY(-6px);
    }
  </style>
</head>
<body>
  <div class="noise"></div>

  <div class="stage" id="stage">
    <div class="card" id="card">
      <div class="plushWrap" id="plushWrap" aria-hidden="true">
        <div class="plush"></div>
        <div class="snout"></div>
        <div class="eye left"></div>
        <div class="eye right"></div>
        <div class="smile"></div>
      </div>

      <h1 class="title" id="title">‚Ä¶</h1>
      <p class="subtitle" id="subtitle">‚Ä¶</p>

      <div class="row">
        <div class="pill" id="pill">‚Äî</div>
        <div class="pill" id="scorePill">Score : 0</div>
      </div>

      <div class="progress" aria-label="progression">
        <div class="bar" id="bar"></div>
      </div>

      <div class="q" id="q"></div>
      <div class="choices" id="choices"></div>
      <div class="note" id="note">‚Äî</div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

<script>
  // ‚öôÔ∏è Personnalisation
  const herName = "Anna";
  const yourName = "Hamza";
  const robotName = "Rose";

  // ‚úÖ Questions
  const quiz = [
    {
      question: "Quelle ann√©e on s‚Äôest rencontr√©s ?",
      choices: ["2022", "2023", "2024", "2025"],
      answer: 2,
      fun: "Ok. D√©marrage parfait."
    },
    {
      question: "La premi√®re chose que je t‚Äôai offerte, c‚Äô√©tait‚Ä¶",
      choices: ["Un bouquet de roses", "Un bracelet", "Une dame de c≈ìur", "Un parfum"],
      answer: 2,
      fun: "Cette info est class√©e ‚Äútr√®s pr√©cieuse‚Äù."
    },
    {
      question: "Notre date le plus insolite, c‚Äô√©tait o√π ?",
      choices: ["Bowling", "Bar √† chats", "Escape game", "Aquarium"],
      answer: 1,
      fun: "Les chats ont approuv√©."
    },
    {
      question: "Nos premi√®res vacances ensemble :",
      choices: ["Cr√®te", "Malte", "Chypre", "Sardaigne"],
      answer: 2,
      fun: "Souvenir valid√©."
    },
    {
      question: "Comment s‚Äôappellent mes parents ?",
      choices: ["Isma√´l et Khadija", "Smail et Khadija", "Smail et Karima", "Sofiane et Khadija"],
      answer: 1,
      fun: "Ok. L√† tu m‚Äôimpressionnes."
    }
  ];

  // ‚úÖ √ânigmes (QCM) entre chaque question (1..4)
  const riddles = [
    {
      title: "√ânigme express",
      text: "Je suis √† toi sans √™tre √† toi. Plus tu me gardes, plus je grandis. Qui suis-je ?",
      choices: ["Un secret", "Une cl√©", "Un cadeau", "Une ombre"],
      answer: 0,
      hint: "Indice : si tu le partages, il change."
    },
    {
      title: "Micro-√©nigme",
      text: "Je commence la nuit et je finis le matin. Qui suis-je ?",
      choices: ["Le r√™ve", "Le sommeil", "Le mot ‚Äúnuit‚Äù", "La lune"],
      answer: 2,
      hint: "Indice : c‚Äôest une histoire de lettres."
    },
    {
      title: "√ânigme douce",
      text: "Je suis plus fort que l‚Äôacier, mais je fond dans un regard. Qui suis-je ?",
      choices: ["La glace", "Le courage", "Le c≈ìur", "Le chocolat"],
      answer: 2,
      hint: "Indice : ce quiz en parle beaucoup."
    },
    {
      title: "√ânigme mini",
      text: "Plus j‚Äôavance, moins tu me vois. Qui suis-je ?",
      choices: ["Le futur", "Le temps", "Le brouillard", "Le soleil"],
      answer: 1,
      hint: "Indice : tu ne peux pas l‚Äôarr√™ter."
    }
  ];

  // Modes
  let mode = "intro"; // intro -> question -> riddle -> ... -> ask
  let i = 0;
  let score = 0;

  // DOM
  const el = (id) => document.getElementById(id);
  const stage = el("stage");
  const card = el("card");
  const plushWrap = el("plushWrap");
  const title = el("title");
  const subtitle = el("subtitle");
  const q = el("q");
  const choices = el("choices");
  const pill = el("pill");
  const scorePill = el("scorePill");
  const bar = el("bar");
  const note = el("note");
  const toast = el("toast");

  function showToast(msg){
    toast.textContent = msg;
    toast.classList.add("show");
    setTimeout(()=>toast.classList.remove("show"), 1200);
  }

  function render(){
    scorePill.textContent = `Score : ${score}`;

    if(mode === "intro"){
      pill.textContent = "Bienvenue";
      bar.style.width = "0%";
      title.textContent = `Hey ${herName}.`;
      subtitle.textContent =
        `${yourName} m‚Äôa demand√© de t‚Äôinviter √† participer √† ce quiz. ` +
        `Je suis ${robotName}, un robot qui pr√©tend comprendre les √©motions humaines. ` +
        `Mes capteurs d√©tectent : sourire discret, yeux brillants, et ‚Äúoui‚Äù non prononc√©.`;
      q.textContent =
        "R√®gles : tu cliques. Tu r√©ponds. Et si tu h√©sites‚Ä¶ je mets √ßa sur le compte du stress amoureux.";
      choices.innerHTML = `
        <button class="primary" id="startBtn">Commencer</button>
        <button class="btn" id="testBtn">Tester mon d√©tecteur d‚Äô√©motions</button>
      `;
      note.textContent = "Info : aucun clavier ne sera n√©cessaire. (Je g√®re.)";

      document.getElementById("startBtn").onclick = () => {
        showToast("Initialisation‚Ä¶");
        mode = "question";
        render();
      };
      document.getElementById("testBtn").onclick = () => {
        showToast("Scan : niveau ‚Äúdangereusement mignon‚Äù d√©tect√©.");
      };
      return;
    }

    if(mode === "question"){
      pill.textContent = `Question ${i+1} / ${quiz.length}`;
      bar.style.width = `${(i / quiz.length) * 100}%`;

      title.textContent = `Question ${i+1}`;
      subtitle.textContent = `${robotName} : je te regarde cliquer.`;
      q.textContent = quiz[i].question;

      choices.innerHTML = "";
      quiz[i].choices.forEach((c, idx) => {
        const b = document.createElement("button");
        b.className = "btn";
        b.textContent = c;
        b.onclick = () => answerQuestion(idx);
        choices.appendChild(b);
      });

      note.textContent = "Clique sur la bonne r√©ponse.";
      return;
    }

    if(mode === "riddle"){
      const r = riddles[i-1];
      pill.textContent = `Interlude ${i} / ${quiz.length-1}`;
      bar.style.width = `${(i / quiz.length) * 100}%`;

      title.textContent = "Interlude";
      subtitle.textContent = `${robotName} : une mini √©nigme pour d√©bloquer la suite.`;
      q.textContent = "";

      choices.innerHTML = `
        <div class="riddle">
          <div class="riddleBox">
            <div class="riddleTitle">${r.title}</div>
            <p class="riddleText">${r.text}</p>
            <div class="riddleHint">${r.hint}</div>
          </div>
        </div>
      `;

      const grid = document.createElement("div");
      grid.className = "choices";
      r.choices.forEach((c, idx) => {
        const b = document.createElement("button");
        b.className = "btn";
        b.textContent = c;
        b.onclick = () => answerRiddle(idx);
        grid.appendChild(b);
      });
      choices.appendChild(grid);

      note.textContent = "D√©bloque la prochaine question.";
      return;
    }

    if(mode === "ask"){
      showAsk();
      return;
    }
  }

  function answerQuestion(idx){
    const current = quiz[i];
    if(idx === current.answer){
      score++;
      showToast("Bonne r√©ponse.");
    } else {
      showToast("Non‚Ä¶ mais √ßa va.");
    }
    showToast(current.fun);

    i++;

    // Apr√®s Q1..Q4 -> √©nigme
    if(i < quiz.length){
      mode = "riddle";
      render();
    } else {
      mode = "ask";
      render();
    }
  }

  function answerRiddle(idx){
    const r = riddles[i-1];
    if(idx === r.answer){
      showToast("√ânigme valid√©e.");
      mode = "question";
      render();
    } else {
      showToast("Presque‚Ä¶ r√©essaie.");
    }
  }

  function showAsk(){
    pill.textContent = "Final";
    bar.style.width = "100%";
    title.textContent = "";
    subtitle.textContent = "";
    q.textContent = "";
    note.textContent = "";

    choices.innerHTML = `
      <div class="askWrap" id="askWrap">
        <div class="banner">${robotName} : mode romance activ√©</div>

        <h2 class="askTitle">VEUX-TU √äTRE<br>MA VALENTINE ?</h2>

        <div class="scene3d" aria-hidden="true">
          <div class="rig" id="rig">
            <div class="flower3d">
              <div class="head">
                <span class="petal"></span><span class="petal"></span><span class="petal"></span><span class="petal"></span>
                <span class="petal"></span><span class="petal"></span><span class="petal"></span><span class="petal"></span>
                <div class="center"></div>
              </div>
              <div class="stem"></div>
              <div class="leaf l1"></div>
              <div class="leaf l2"></div>
            </div>

            <div class="choco3d">
              <div class="bar"></div>
              <div class="wrap"></div>
              <div class="grid">
                <div class="sq"></div><div class="sq"></div><div class="sq"></div>
                <div class="sq"></div><div class="sq"></div><div class="sq"></div>
              </div>
            </div>

            <div class="heart3d">
              <div class="depth"></div>
              <div class="core"></div>
            </div>

            <span class="spark" style="left:10%; top:18%; animation-delay:.1s"></span>
            <span class="spark" style="left:22%; top:10%; animation-delay:.7s"></span>
            <span class="spark" style="left:52%; top:14%; animation-delay:.3s"></span>
            <span class="spark" style="left:76%; top:10%; animation-delay:.9s"></span>
            <span class="spark" style="left:90%; top:22%; animation-delay:.5s"></span>
          </div>
        </div>

        <div class="askButtons">
          <button class="yesBtn" id="yesBtn">OUI</button>
          <button class="noBtn" id="noBtn">NON</button>
        </div>
      </div>
    `;

    const wrap = document.getElementById("askWrap");
    const rig = document.getElementById("rig");
    const yesBtn = document.getElementById("yesBtn");
    const noBtn = document.getElementById("noBtn");

    yesBtn.onclick = () => {
      showToast("‚úÖ OUI enregistr√©.");
      // mini effet : acc√©l√®re un peu la sc√®ne
      rig.style.animationDuration = "4.8s";
      yesBtn.textContent = "OUI üíò";
      yesBtn.classList.add("primary");
    };

    // NON qui fuit (elle essaie de cliquer, mais il se barre)
    function moveNo(){
      const r = wrap.getBoundingClientRect();
      const pad = 14;

      const maxX = r.left + r.width - (noBtn.offsetWidth + pad);
      const minX = r.left + pad;

      const minY = r.top + 120;
      const maxY = r.top + r.height - (noBtn.offsetHeight + pad);

      const x = minX + Math.random() * Math.max(1, (maxX - minX));
      const y = minY + Math.random() * Math.max(1, (maxY - minY));

      noBtn.style.position = "fixed";
      noBtn.style.left = `${x}px`;
      noBtn.style.top  = `${y}px`;
    }

    // fuite au survol + quand on approche (plus dr√¥le)
    noBtn.addEventListener("mouseenter", () => {
      showToast("NON : *panique*");
      moveNo();
    });

    // si elle arrive √† cliquer: transforme en OK
    noBtn.onclick = () => {
      showToast("NON indisponible.");
      noBtn.textContent = "OK";
      noBtn.classList.add("primary");
      noBtn.onclick = () => yesBtn.click();
    };

    setTimeout(moveNo, 60);

    // petit parallax sur la sc√®ne finale (super styl√©)
    wrap.addEventListener("mousemove", (e) => {
      const rr = wrap.getBoundingClientRect();
      const px = (e.clientX - rr.left) / rr.width;   // 0..1
      const py = (e.clientY - rr.top) / rr.height;   // 0..1
      const rx = (0.5 - py) * 10;
      const ry = (px - 0.5) * 12;
      rig.style.transform = `rotateX(${rx}deg) rotateY(${ry}deg)`;
    });
    wrap.addEventListener("mouseleave", () => {
      rig.style.transform = `rotateX(0deg) rotateY(0deg)`;
    });
  }

  // Effet 3D / parallax (carte + peluche) sur tout le quiz
  function clamp(n, min, max){ return Math.max(min, Math.min(max, n)); }
  stage.addEventListener("mousemove", (e) => {
    const r = card.getBoundingClientRect();
    const px = (e.clientX - r.left) / r.width;
    const py = (e.clientY - r.top) / r.height;

    const rx = clamp((0.5 - py) * 10, -8, 8);
    const ry = clamp((px - 0.5) * 12, -10, 10);

    card.style.transform = `rotateX(${rx}deg) rotateY(${ry}deg)`;
    card.style.setProperty("--mx", `${px*100}%`);
    card.style.setProperty("--my", `${py*100}%`);

    plushWrap.style.transform =
      `translate3d(${(px-0.5)*10}px, ${(py-0.5)*10}px, 0) rotateY(${ry*0.6}deg) rotateX(${rx*0.6}deg)`;
  });
  stage.addEventListener("mouseleave", () => {
    card.style.transform = `rotateX(0deg) rotateY(0deg)`;
    plushWrap.style.transform = `translate3d(0,0,0) rotateX(0deg) rotateY(0deg)`;
  });

  // Start
  render();
</script>
</body>
</html>
